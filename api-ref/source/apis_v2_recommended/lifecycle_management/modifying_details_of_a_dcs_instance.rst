:original_name: UpdateInstance.html

.. _UpdateInstance:

Modifying Details of a DCS Instance
===================================

Function
--------

This API is used to modify the information about a DCS instance, including the instance name, description, port, backup policy, start and end time of the maintenance window, and security group.

URI
---

PUT /v2/{project_id}/instances/{instance_id}

.. table:: **Table 1** Path Parameters

   +-------------+-----------+--------+-------------------------------------------------------------------------------+
   | Parameter   | Mandatory | Type   | Description                                                                   |
   +=============+===========+========+===============================================================================+
   | instance_id | Yes       | String | Instance ID.                                                                  |
   +-------------+-----------+--------+-------------------------------------------------------------------------------+
   | project_id  | Yes       | String | Project ID. For details, see :ref:`Obtaining a Project ID <dcs-api-0312045>`. |
   +-------------+-----------+--------+-------------------------------------------------------------------------------+

Request Parameters
------------------

.. table:: **Table 2** Request body parameters

   +------------------------+-----------------+-----------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter              | Mandatory       | Type                                                                        | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
   +========================+=================+=============================================================================+=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
   | name                   | No              | String                                                                      | Instance name.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
   |                        |                 |                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   |                        |                 |                                                                             | An instance name can contain letters, digits, underscores (_), and hyphens (-) and must start with a letter.                                                                                                                                                                                                                                                                                                                                                                                                |
   |                        |                 |                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   |                        |                 |                                                                             | When you create only one instance at a time, the value of this parameter can contain 4 to 64 characters. When you create multiple instances at a time, the value of this parameter can contain 4 to 56 characters. The instances are named in the format of *custom name*\ ``-``\ *n*, where *n* starts from 000 and is incremented by 1. For example, if you create two instances and set the custom name to **dcs_demo**, the two instances are respectively named **dcs_demo-000** and **dcs_demo-001**. |
   +------------------------+-----------------+-----------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | description            | No              | String                                                                      | Instance description.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                        |                 |                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   |                        |                 |                                                                             | The description can contain a maximum of 1024 characters.                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                        |                 |                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   |                        |                 |                                                                             | .. note::                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                        |                 |                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   |                        |                 |                                                                             |    The backslash (\\) and quotation mark (") are special characters for JSON messages. When using these characters in a parameter value, add the escape character (\\) before the characters, for example, **\\\\** and **\\"**.                                                                                                                                                                                                                                                                            |
   +------------------------+-----------------+-----------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | port                   | No              | Integer                                                                     | Port for connecting to the Redis instance. The port range is from 1 to 65535.                                                                                                                                                                                                                                                                                                                                                                                                                               |
   |                        |                 |                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   |                        |                 |                                                                             | After the port is changed, all connections to the Redis instance are interrupted, and services must connect to the new port.                                                                                                                                                                                                                                                                                                                                                                                |
   |                        |                 |                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   |                        |                 |                                                                             | Only DCS Redis 4.0 and later instances support port change.                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
   +------------------------+-----------------+-----------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | rename_commands        | No              | :ref:`RenameCommandResp <updateinstance__request_renamecommandresp>` object | Command renaming list.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   +------------------------+-----------------+-----------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | maintain_begin         | No              | String                                                                      | UTC time when the maintenance time window starts. The format is HH:mm:ss.                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   |                        |                 |                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   |                        |                 |                                                                             | -  The start time and end time of the maintenance window must be within the time segment of a supported maintenance window. For details, see :ref:`Listing Maintenance Time Windows <listmaintenancewindows>`.                                                                                                                                                                                                                                                                                              |
   |                        |                 |                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   |                        |                 |                                                                             | -  For example, the start time must be 18:00:00, 19:00:00, and so on.                                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |                        |                 |                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   |                        |                 |                                                                             | -  The start time and end time must be set in pairs. If the start time is left blank, the end time must also be left blank.                                                                                                                                                                                                                                                                                                                                                                                 |
   +------------------------+-----------------+-----------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | maintain_end           | No              | String                                                                      | UTC time when the maintenance time window ends. The format is HH:mm:ss.                                                                                                                                                                                                                                                                                                                                                                                                                                     |
   |                        |                 |                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   |                        |                 |                                                                             | -  The start time and end time of the maintenance window must be within the time segment of a supported maintenance window. For details, see :ref:`Listing Maintenance Time Windows <listmaintenancewindows>`.                                                                                                                                                                                                                                                                                              |
   |                        |                 |                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   |                        |                 |                                                                             | -  The end time is one hour later than the start time. For example, if the start time is 18:00:00, the end time is 19:00:00.                                                                                                                                                                                                                                                                                                                                                                                |
   |                        |                 |                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   |                        |                 |                                                                             | -  The start time and end time must be set in pairs. If the end time is left blank, the start time must also be left blank.                                                                                                                                                                                                                                                                                                                                                                                 |
   +------------------------+-----------------+-----------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | security_group_id      | No              | String                                                                      | Security group ID.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
   |                        |                 |                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   |                        |                 |                                                                             | The value can be obtained from the VPC console or the API used to query the security group list.                                                                                                                                                                                                                                                                                                                                                                                                            |
   |                        |                 |                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   |                        |                 |                                                                             | This parameter is supported only by DCS Redis 3.0 instances.                                                                                                                                                                                                                                                                                                                                                                                                                                                |
   +------------------------+-----------------+-----------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | instance_backup_policy | No              | :ref:`BackupPolicy <updateinstance__request_backuppolicy>` object           | Backup policy. This parameter is supported when the instance type is master/standby or cluster.                                                                                                                                                                                                                                                                                                                                                                                                             |
   +------------------------+-----------------+-----------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _updateinstance__request_renamecommandresp:

.. table:: **Table 3** RenameCommandResp

   ========= ========= ====== =====================
   Parameter Mandatory Type   Description
   ========= ========= ====== =====================
   command   No        String Command **COMMAND**.
   flushall  No        String Command **FLUSHALL**.
   flushdb   No        String Command **FLUSHDB**.
   hgetall   No        String Command **HGETALL**.
   keys      No        String Command **KEYS**.
   ========= ========= ====== =====================

.. _updateinstance__request_backuppolicy:

.. table:: **Table 4** BackupPolicy

   +------------------------+-----------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter              | Mandatory       | Type                                                          | Description                                                                                                                                                                         |
   +========================+=================+===============================================================+=====================================================================================================================================================================================+
   | backup_type            | Yes             | String                                                        | Backup type.                                                                                                                                                                        |
   |                        |                 |                                                               |                                                                                                                                                                                     |
   |                        |                 |                                                               | -  **auto**: automatic backup                                                                                                                                                       |
   |                        |                 |                                                               |                                                                                                                                                                                     |
   |                        |                 |                                                               | -  **manual**: manual backup                                                                                                                                                        |
   +------------------------+-----------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | save_days              | No              | Integer                                                       | This parameter is mandatory when **backup_type** is set to **manual**.                                                                                                              |
   |                        |                 |                                                               |                                                                                                                                                                                     |
   |                        |                 |                                                               | Retention period, in days. The value ranges from 1 to 7. The automatic backup policy is retained when automatic backup is switched to manual backup.                                |
   +------------------------+-----------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | periodical_backup_plan | No              | :ref:`BackupPlan <updateinstance__request_backupplan>` object | Backup schedule. This parameter is mandatory when **backup_type** is set to **manual**. The automatic backup policy is retained when automatic backup is switched to manual backup. |
   +------------------------+-----------------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _updateinstance__request_backupplan:

.. table:: **Table 5** BackupPlan

   +-----------------+-----------+-------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory | Type              | Description                                                                                                                                                                                                                                                                   |
   +=================+===========+===================+===============================================================================================================================================================================================================================================================================+
   | timezone_offset | No        | String            | Time zone in which backup is performed. This parameter is no longer used.                                                                                                                                                                                                     |
   +-----------------+-----------+-------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | backup_at       | Yes       | Array of integers | Day in a week on which backup starts. The value ranges from **1** to **7**, where **1** indicates Monday, and **7** indicates Sunday. The automatic backup policy is retained when automatic backup is switched to manual backup.                                             |
   +-----------------+-----------+-------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | period_type     | Yes       | String            | Interval at which backup is performed, which supports only **weekly** currently. The automatic backup policy is retained when automatic backup is switched to manual backup.                                                                                                  |
   +-----------------+-----------+-------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | begin_at        | Yes       | String            | UTC time when the backup starts. For example, **00:00-01:00** indicates that the backup starts at 00:00 (UTC time). The value must be on the hour. The backup interval is 1 hour. The automatic backup policy is retained when automatic backup is switched to manual backup. |
   +-----------------+-----------+-------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Response Parameters
-------------------

None

Example Requests
----------------

Changing the name of a specified instance to dcs002 and port to 6379, and configuring an auto backup policy

.. code-block:: text

   PUT https://{dcs_endpoint}/v2/{project_id}/instance/{instance_id}

   {
     "name" : "dcs002",
     "description" : "instance description",
     "port" : 6379,
     "maintain_begin" : "18:00:00",
     "maintain_end" : "19:00:00",
     "security_group_id" : "18e9309f-f81a-4749-bb21-f74576292162",
     "instance_backup_policy" : {
       "backup_type" : "auto",
       "save_days" : "1,",
       "periodical_backup_plan" : {
         "backup_at" : [ "1", "2", "3", "4", "6", "7" ],
         "period_type" : "weekly",
         "begin_at" : "00:00-01:00"
       }
     }
   }

Example Responses
-----------------

None

Status Codes
------------

=========== ===================================
Status Code Description
=========== ===================================
204         DCS instance modified successfully.
400         Invalid request.
500         Internal service error.
=========== ===================================

Error Codes
-----------

See :ref:`Error Codes <errorcode>`.
