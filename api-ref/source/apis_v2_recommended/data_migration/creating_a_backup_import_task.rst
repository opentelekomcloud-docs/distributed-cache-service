:original_name: CreateMigrationTask.html

.. _CreateMigrationTask:

Creating a Backup Import Task
=============================

Function
--------

This API is used to create a backup import task.

URI
---

POST /v2/{project_id}/migration-task

.. table:: **Table 1** Path Parameters

   +------------+-----------+--------+-------------------------------------------------------------------------------+
   | Parameter  | Mandatory | Type   | Description                                                                   |
   +============+===========+========+===============================================================================+
   | project_id | Yes       | String | Project ID. For details, see :ref:`Obtaining a Project ID <dcs-api-0312045>`. |
   +------------+-----------+--------+-------------------------------------------------------------------------------+

Request Parameters
------------------

.. table:: **Table 2** Request body parameters

   +------------------+-----------------+------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter        | Mandatory       | Type                                                                               | Description                                                                                                                                                                                                                                                                      |
   +==================+=================+====================================================================================+==================================================================================================================================================================================================================================================================================+
   | task_name        | Yes             | String                                                                             | Backup import task name.                                                                                                                                                                                                                                                         |
   +------------------+-----------------+------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | description      | No              | String                                                                             | Backup import task description.                                                                                                                                                                                                                                                  |
   +------------------+-----------------+------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | migration_type   | Yes             | String                                                                             | Migration mode. Options:                                                                                                                                                                                                                                                         |
   |                  |                 |                                                                                    |                                                                                                                                                                                                                                                                                  |
   |                  |                 |                                                                                    | -  **backupfile_import**: importing backup files                                                                                                                                                                                                                                 |
   |                  |                 |                                                                                    |                                                                                                                                                                                                                                                                                  |
   |                  |                 |                                                                                    | -  **online_migration**: migrating data online This API can no longer be used to create an online migration task. Please call :ref:`CreateOnlineMigrationTask <createonlinemigrationtask>` instead.                                                                              |
   |                  |                 |                                                                                    |                                                                                                                                                                                                                                                                                  |
   |                  |                 |                                                                                    | Enumeration values:                                                                                                                                                                                                                                                              |
   |                  |                 |                                                                                    |                                                                                                                                                                                                                                                                                  |
   |                  |                 |                                                                                    | -  **backupfile_import**                                                                                                                                                                                                                                                         |
   +------------------+-----------------+------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | migration_method | Yes             | String                                                                             | Type of the migration, which can be full migration or incremental migration. Values:                                                                                                                                                                                             |
   |                  |                 |                                                                                    |                                                                                                                                                                                                                                                                                  |
   |                  |                 |                                                                                    | -  **full_amount_migration**: full migration                                                                                                                                                                                                                                     |
   |                  |                 |                                                                                    |                                                                                                                                                                                                                                                                                  |
   |                  |                 |                                                                                    | -  **incremental_migration**: incremental migration                                                                                                                                                                                                                              |
   |                  |                 |                                                                                    |                                                                                                                                                                                                                                                                                  |
   |                  |                 |                                                                                    | Enumeration values:                                                                                                                                                                                                                                                              |
   |                  |                 |                                                                                    |                                                                                                                                                                                                                                                                                  |
   |                  |                 |                                                                                    | -  **full_amount_migration**                                                                                                                                                                                                                                                     |
   |                  |                 |                                                                                    |                                                                                                                                                                                                                                                                                  |
   |                  |                 |                                                                                    | -  **incremental_migration**                                                                                                                                                                                                                                                     |
   +------------------+-----------------+------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | backup_files     | No              | :ref:`BackupFilesBody <createmigrationtask__request_backupfilesbody>` object       | Backup files to be imported when the migration mode is backup file import.                                                                                                                                                                                                       |
   +------------------+-----------------+------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | network_type     | No              | String                                                                             | Type of the network for communication between the source and target Redis when the migration mode is online data migration. This API can no longer be used to create an online migration task. Please call :ref:`CreateOnlineMigrationTask <createonlinemigrationtask>` instead. |
   |                  |                 |                                                                                    |                                                                                                                                                                                                                                                                                  |
   |                  |                 |                                                                                    | Enumeration values:                                                                                                                                                                                                                                                              |
   |                  |                 |                                                                                    |                                                                                                                                                                                                                                                                                  |
   |                  |                 |                                                                                    | -  **vpc**                                                                                                                                                                                                                                                                       |
   |                  |                 |                                                                                    |                                                                                                                                                                                                                                                                                  |
   |                  |                 |                                                                                    | -  **vpn**                                                                                                                                                                                                                                                                       |
   +------------------+-----------------+------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | source_instance  | No              | :ref:`SourceInstanceBody <createmigrationtask__request_sourceinstancebody>` object | Source Redis information. This parameter is mandatory when the migration mode is online data migration. This API can no longer be used to create an online migration task. Please call :ref:`CreateOnlineMigrationTask <createonlinemigrationtask>` instead.                     |
   +------------------+-----------------+------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | target_instance  | Yes             | :ref:`TargetInstanceBody <createmigrationtask__request_targetinstancebody>` object | Target Redis information.                                                                                                                                                                                                                                                        |
   +------------------+-----------------+------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _createmigrationtask__request_backupfilesbody:

.. table:: **Table 3** BackupFilesBody

   +-----------------+-----------------+--------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type                                                               | Description                                                                                             |
   +=================+=================+====================================================================+=========================================================================================================+
   | file_source     | No              | String                                                             | Data source, which can be an OBS bucket or a backup record.                                             |
   |                 |                 |                                                                    |                                                                                                         |
   |                 |                 |                                                                    | Enumeration values:                                                                                     |
   |                 |                 |                                                                    |                                                                                                         |
   |                 |                 |                                                                    | -  **self_build_obs**                                                                                   |
   |                 |                 |                                                                    |                                                                                                         |
   |                 |                 |                                                                    | -  **backup_record**                                                                                    |
   +-----------------+-----------------+--------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------+
   | bucket_name     | Yes             | String                                                             | Name of the OBS bucket.                                                                                 |
   +-----------------+-----------------+--------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------+
   | files           | Yes             | Array of :ref:`Files <createmigrationtask__request_files>` objects | List of backup files to be imported. This parameter is mandatory when the data source is an OBS bucket. |
   +-----------------+-----------------+--------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------+
   | backup_id       | No              | String                                                             | Backup record ID. This parameter is mandatory when the data source is a backup record.                  |
   +-----------------+-----------------+--------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------+

.. _createmigrationtask__request_files:

.. table:: **Table 4** Files

   +-----------+-----------+--------+--------------------------------------------------------------------------+
   | Parameter | Mandatory | Type   | Description                                                              |
   +===========+===========+========+==========================================================================+
   | file_name | Yes       | String | Name of a backup file.                                                   |
   +-----------+-----------+--------+--------------------------------------------------------------------------+
   | size      | No        | String | File size in bytes.                                                      |
   +-----------+-----------+--------+--------------------------------------------------------------------------+
   | update_at | No        | String | Time when the file was last modified. The format is YYYY-MM-DD HH:MM:SS. |
   +-----------+-----------+--------+--------------------------------------------------------------------------+

.. _createmigrationtask__request_sourceinstancebody:

.. table:: **Table 5** SourceInstanceBody

   +----------------+-----------+---------+------------------------------------------------------------------------+
   | Parameter      | Mandatory | Type    | Description                                                            |
   +================+===========+=========+========================================================================+
   | addrs          | Yes       | String  | Source Redis address (specified in the **source_instance** parameter). |
   +----------------+-----------+---------+------------------------------------------------------------------------+
   | password       | No        | String  | Redis password. If a password is set, this parameter is mandatory.     |
   +----------------+-----------+---------+------------------------------------------------------------------------+
   | task_status    | No        | String  | Task status.                                                           |
   +----------------+-----------+---------+------------------------------------------------------------------------+
   | id             | No        | String  | Redis instance ID.                                                     |
   +----------------+-----------+---------+------------------------------------------------------------------------+
   | ip             | No        | String  | Redis IP address.                                                      |
   +----------------+-----------+---------+------------------------------------------------------------------------+
   | port           | No        | String  | Redis port.                                                            |
   +----------------+-----------+---------+------------------------------------------------------------------------+
   | name           | No        | String  | Redis name.                                                            |
   +----------------+-----------+---------+------------------------------------------------------------------------+
   | proxy_multi_db | No        | Boolean | Indicates whether multi-DB is enabled for Proxy Cluster DCS instances. |
   +----------------+-----------+---------+------------------------------------------------------------------------+
   | db             | No        | String  | Redis database.                                                        |
   +----------------+-----------+---------+------------------------------------------------------------------------+

.. _createmigrationtask__request_targetinstancebody:

.. table:: **Table 6** TargetInstanceBody

   +----------------+-----------+---------+------------------------------------------------------------------------+
   | Parameter      | Mandatory | Type    | Description                                                            |
   +================+===========+=========+========================================================================+
   | id             | Yes       | String  | Redis instance ID (mandatory in the **target_instance** parameter).    |
   +----------------+-----------+---------+------------------------------------------------------------------------+
   | name           | No        | String  | Redis instance name (specified in the **target_instance** parameter).  |
   +----------------+-----------+---------+------------------------------------------------------------------------+
   | password       | No        | String  | Redis password. If a password is set, this parameter is mandatory.     |
   +----------------+-----------+---------+------------------------------------------------------------------------+
   | ip             | No        | String  | Redis IP address.                                                      |
   +----------------+-----------+---------+------------------------------------------------------------------------+
   | port           | No        | String  | Redis port.                                                            |
   +----------------+-----------+---------+------------------------------------------------------------------------+
   | addrs          | No        | String  | Redis instance address.                                                |
   +----------------+-----------+---------+------------------------------------------------------------------------+
   | proxy_multi_db | No        | Boolean | Indicates whether multi-DB is enabled for Proxy Cluster DCS instances. |
   +----------------+-----------+---------+------------------------------------------------------------------------+
   | db             | No        | String  | Redis database.                                                        |
   +----------------+-----------+---------+------------------------------------------------------------------------+

Response Parameters
-------------------

**Status code: 200**

.. table:: **Table 7** Response body parameters

   +-----------------------+-----------------------+------------------------------------------------------------------------------------+
   | Parameter             | Type                  | Description                                                                        |
   +=======================+=======================+====================================================================================+
   | id                    | String                | Migration task ID.                                                                 |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------+
   | name                  | String                | Migration task name.                                                               |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------+
   | status                | String                | Migration status. Options: **SUCCESS**, **FAILED**, **MIGRATING**, **TERMINATED**. |
   |                       |                       |                                                                                    |
   |                       |                       | Enumeration values:                                                                |
   |                       |                       |                                                                                    |
   |                       |                       | -  **SUCCESS**                                                                     |
   |                       |                       |                                                                                    |
   |                       |                       | -  **FAILED**                                                                      |
   |                       |                       |                                                                                    |
   |                       |                       | -  **MIGRATING**                                                                   |
   |                       |                       |                                                                                    |
   |                       |                       | -  **TERMINATED**                                                                  |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------+
   | error                 | String                | Error message.                                                                     |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------+

**Status code: 400**

.. table:: **Table 8** Response body parameters

   +-----------------------+-----------------------+------------------------------------------------------------------------------------------+
   | Parameter             | Type                  | Description                                                                              |
   +=======================+=======================+==========================================================================================+
   | error_msg             | String                | Error message.                                                                           |
   |                       |                       |                                                                                          |
   |                       |                       | Maximum: **1024**                                                                        |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------+
   | error_code            | String                | Error code.                                                                              |
   |                       |                       |                                                                                          |
   |                       |                       | Maximum: **9**                                                                           |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------+
   | error_ext_msg         | String                | Extended error information. This parameter is not used currently and is set to **null**. |
   |                       |                       |                                                                                          |
   |                       |                       | Maximum: **1024**                                                                        |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------+

**Status code: 401**

.. table:: **Table 9** Response body parameters

   +-----------------------+-----------------------+------------------------------------------------------------------------------------------+
   | Parameter             | Type                  | Description                                                                              |
   +=======================+=======================+==========================================================================================+
   | error_msg             | String                | Error message.                                                                           |
   |                       |                       |                                                                                          |
   |                       |                       | Maximum: **1024**                                                                        |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------+
   | error_code            | String                | Error code.                                                                              |
   |                       |                       |                                                                                          |
   |                       |                       | Maximum: **9**                                                                           |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------+
   | error_ext_msg         | String                | Extended error information. This parameter is not used currently and is set to **null**. |
   |                       |                       |                                                                                          |
   |                       |                       | Maximum: **1024**                                                                        |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------+

**Status code: 403**

.. table:: **Table 10** Response body parameters

   +-----------------------+-----------------------+------------------------------------------------------------------------------------------+
   | Parameter             | Type                  | Description                                                                              |
   +=======================+=======================+==========================================================================================+
   | error_msg             | String                | Error message.                                                                           |
   |                       |                       |                                                                                          |
   |                       |                       | Maximum: **1024**                                                                        |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------+
   | error_code            | String                | Error code.                                                                              |
   |                       |                       |                                                                                          |
   |                       |                       | Maximum: **9**                                                                           |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------+
   | error_ext_msg         | String                | Extended error information. This parameter is not used currently and is set to **null**. |
   |                       |                       |                                                                                          |
   |                       |                       | Maximum: **1024**                                                                        |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------+

**Status code: 404**

.. table:: **Table 11** Response body parameters

   +-----------------------+-----------------------+------------------------------------------------------------------------------------------+
   | Parameter             | Type                  | Description                                                                              |
   +=======================+=======================+==========================================================================================+
   | error_msg             | String                | Error message.                                                                           |
   |                       |                       |                                                                                          |
   |                       |                       | Maximum: **1024**                                                                        |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------+
   | error_code            | String                | Error code.                                                                              |
   |                       |                       |                                                                                          |
   |                       |                       | Maximum: **9**                                                                           |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------+
   | error_ext_msg         | String                | Extended error information. This parameter is not used currently and is set to **null**. |
   |                       |                       |                                                                                          |
   |                       |                       | Maximum: **1024**                                                                        |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------+

**Status code: 500**

.. table:: **Table 12** Response body parameters

   +-----------------------+-----------------------+------------------------------------------------------------------------------------------+
   | Parameter             | Type                  | Description                                                                              |
   +=======================+=======================+==========================================================================================+
   | error_msg             | String                | Error message.                                                                           |
   |                       |                       |                                                                                          |
   |                       |                       | Maximum: **1024**                                                                        |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------+
   | error_code            | String                | Error code.                                                                              |
   |                       |                       |                                                                                          |
   |                       |                       | Maximum: **9**                                                                           |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------+
   | error_ext_msg         | String                | Extended error information. This parameter is not used currently and is set to **null**. |
   |                       |                       |                                                                                          |
   |                       |                       | Maximum: **1024**                                                                        |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------+

Example Requests
----------------

Creating a backup import task to migrate data from an OBS bucket

.. code-block:: text

   POST https://{dcs_endpoint}/v2/{project_id}/migration-task

   {
     "task_name" : "migration1",
     "description" : "Test",
     "migration_type" : "backupfile_import",
     "migration_method" : "full_amount_migration",
     "backup_files" : {
       "bucket_name" : "bucketName",
       "file_source" : "self_build_obs",
       "files" : [ {
         "size" : "754.0MB",
         "file_name" : "fileName"
       } ]
     },
     "target_instance" : {
       "id" : "d2c8399f-bdba-43c1-8069-3ff17a1a79d5",
       "name" : "dcs-test",
       "password" : "xxxxxx"
     }
   }

Example Responses
-----------------

**Status code: 200**

Backup import task created.

.. code-block::

   {
     "id" : "8aa6999e71cb638b0171f485f5266ef0",
     "name" : "dcs-test",
     "status" : "MIGRATING",
     "error" : ""
   }

Status Codes
------------

=========== ====================================
Status Code Description
=========== ====================================
200         Backup import task created.
400         Invalid request.
401         Invalid authentication information.
403         The request is rejected.
404         The requested resource is not found.
500         Internal service error.
=========== ====================================

Error Codes
-----------

See :ref:`Error Codes <errorcode>`.
